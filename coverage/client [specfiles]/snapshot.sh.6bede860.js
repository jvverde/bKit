var data = {lines:[
{"lineNum":"    1","line":"#!/usr/bin/env bash"},
{"lineNum":"    2","line":"#Backup shadow copies if it is a NTFS and a Fixed Disk. And user have admin rights (544 output from id -G)"},
{"lineNum":"    3","line":"#In case of shodow copies it also rewrite path locatiosn for possible filter rsync options"},
{"lineNum":"    4","line":"#In all other situation just call backup.sh"},
{"lineNum":"    5","line":""},
{"lineNum":"    6","line":"declare sdir=\"$(dirname -- \"$(readlink -ne -- \"$0\")\")\"\t\t\t\t#Full DIR","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"    7","line":""},
{"lineNum":"    8","line":"source \"$sdir/lib/functions/all.sh\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"    9","line":""},
{"lineNum":"   10","line":""},
{"lineNum":"   11","line":"MOUNTED=()"},
{"lineNum":"   12","line":"getdev(){"},
{"lineNum":"   13","line":"    DEV=$(\"$sdir/lib/getdev.sh\" \"$1\"|head -n1|perl -lape \'s/(?:\\r|\\n)+$//g\') || die \"Device $1 not found\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   14","line":"\texists cygpath && DEV=\"$(cygpath -u \"$DEV\")\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   15","line":"    DEV=$(readlink -e \"$DEV\") || die \"Device \'$DEV\' doesn\'t exists\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   16","line":"    MOUNT=$(df --output=target,fstype \"$DEV\"|tail -n 1|fgrep -v devtmpfs|cut -f1 -d\' \')","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   17","line":"    [[ -z $MOUNT && $UID -eq 0  && -b $DEV ]] && { #if it is a block device, then check if it is mounted and mount it if not","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   18","line":"\tmktempdir MOUNT || die \"can\'t make temporary directory \'$MOUNT\'\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   19","line":"        mount -o ro $DEV  $MOUNT || die Cannot mount $DEV on $MOUNT","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   20","line":"        MOUNTED+=( \"$MOUNT\" )","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   21","line":"    }"},
{"lineNum":"   22","line":"    [[ -e $MOUNT ]] || die \"Disk $DEV is not mounted\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   23","line":"    MOUNT=${MOUNT%/} #remove trailing slash if any","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   24","line":"}"},
{"lineNum":"   25","line":""},
{"lineNum":"   26","line":"#echo args=\"${@}\""},
{"lineNum":"   27","line":"declare -a rsyncoptions=()","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   28","line":"declare -a options=()","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   29","line":"while [[ $1 =~ ^- ]]","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   30","line":"do"},
{"lineNum":"   31","line":"    KEY=\"$1\" && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   32","line":"    case \"$KEY\" in","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   33","line":"        -l|-log|--log)"},
{"lineNum":"   34","line":"            exec 1>\"$1\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   35","line":"            shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   36","line":"        ;;"},
{"lineNum":"   37","line":"        -l=*|-log=*|--log=*)"},
{"lineNum":"   38","line":"            exec 1>\"${KEY#*=}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   39","line":"        ;;"},
{"lineNum":"   40","line":"        --logdir)"},
{"lineNum":"   41","line":"            redirectlogs $1 snapshot && shift\t\t\t#redirectlogs is defined on util.sh","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   42","line":"        ;;"},
{"lineNum":"   43","line":"        --logdir=*)"},
{"lineNum":"   44","line":"            redirectlogs \"${KEY#*=}\" snapshot\t\t\t#redirect to argument given and prefix the log files with \'snapshot\' string","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   45","line":"        ;;"},
{"lineNum":"   46","line":"        -u|--uuid)"},
{"lineNum":"   47","line":"            getdev \"$1\" && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   48","line":"        ;;"},
{"lineNum":"   49","line":"        -u=*|--uuid=*)"},
{"lineNum":"   50","line":"            getdev \"${KEY#*=}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   51","line":"        ;;"},
{"lineNum":"   52","line":"        -- )"},
{"lineNum":"   53","line":"            while [[ $1 =~ ^- ]]","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   54","line":"            do"},
{"lineNum":"   55","line":"                rsyncoptions+=( \"$1\" )","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   56","line":"                shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   57","line":"            done"},
{"lineNum":"   58","line":"        ;;"},
{"lineNum":"   59","line":"        --stats|--sendlogs|--notify)"},
{"lineNum":"   60","line":"            options+=( \"$KEY\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   61","line":"        ;;"},
{"lineNum":"   62","line":"        *=*)"},
{"lineNum":"   63","line":"            options+=( \"$KEY\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   64","line":"        ;;"},
{"lineNum":"   65","line":"        *)"},
{"lineNum":"   66","line":"            options+=( \"$KEY\" \"$1\" ) && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   67","line":"        ;;"},
{"lineNum":"   68","line":"    esac"},
{"lineNum":"   69","line":"done"},
{"lineNum":"   70","line":""},
{"lineNum":"   71","line":"DIRS=(\"$@\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   72","line":""},
{"lineNum":"   73","line":"declare -A ROOTS","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   74","line":"declare -A ROOTOF","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   75","line":""},
{"lineNum":"   76","line":"for DIR in \"${DIRS[@]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   77","line":"do"},
{"lineNum":"   78","line":"    [[ ${MOUNT+isset} == isset ]] && FULL=$MOUNT/${DIR#/} || FULL=\"$DIR\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   79","line":"    FULL=$(readlink -ne \"$FULL\") || continue","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   80","line":"    exists cygpath && FULL=$(cygpath -u \"$FULL\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   81","line":"    ROOT=$(stat -c%m \"$FULL\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   82","line":"    ROOTS[\"$ROOT\"]=1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   83","line":"    ROOTOF[\"$FULL\"]=$ROOT","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   84","line":"done"},
{"lineNum":"   85","line":""},
{"lineNum":"   86","line":"backup() {"},
{"lineNum":"   87","line":"    echo Backup directly -- without shadow copy","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   88","line":"    bash \"$sdir/backup.sh\" ${options[@]+\"${options[@]}\"} -- ${rsyncoptions[@]+\"${rsyncoptions[@]}\"} \"$@\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   89","line":"}"},
{"lineNum":"   90","line":""},
{"lineNum":"   91","line":"ntfssnap(){"},
{"lineNum":"   92","line":"    echo Backup a ntfs shadow copy","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   93","line":"    local SHADOWSPAN=$(find \"$sdir/3rd-party\" -type f -iname \'ShadowSpawn.exe\' -print -quit)","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   94","line":"    for I in \"${!rsyncoptions[@]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   95","line":"    do"},
{"lineNum":"   96","line":"        [[ ${rsyncoptions[$I]} =~ --filter=\\.[[:space:]]+ ]] && { # map rules from original root to mapped root","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   97","line":"            local FILE=\"$(echo ${rsyncoptions[$I]} | cut -d\' \' -f2-)\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   98","line":"            local NEWFILE=\"$RUNDIR/rule-$$.$I\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   99","line":"            local OLDROOT=$(cygpath -u \"$1\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  100","line":"            local NEWROOT=$(cygpath -u \"$2\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  101","line":"            OLDROOT=${OLDROOT%/}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  102","line":"            NEWROOT=${NEWROOT%/}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  103","line":"            cat \"$FILE\" |sed -E \"s#([+-]/?\\s+)$OLDROOT#\\\\1$NEWROOT#\" > \"$NEWFILE\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  104","line":"            rsyncoptions[$I]=${rsyncoptions[$I]/$FILE/$NEWFILE} #replace original rule file by a temporary rule file","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  105","line":"            RMFILES+=( \"$NEWFILE\" ) #include temporary rule in a list of files to remove at the end.","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  106","line":"        }"},
{"lineNum":"  107","line":"    done"},
{"lineNum":"  108","line":"    \"$SHADOWSPAN\" /verbosity=2 \"$1\" \"$2\" \"$DOSBASH\" \"$sdir/backup.sh\" ${options[@]+\"${options[@]}\"} --map \"$2\" -- ${rsyncoptions[@]+\"${rsyncoptions[@]}\"} \"${@:3}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  109","line":" }"},
{"lineNum":"  110","line":""},
{"lineNum":"  111","line":"mktempdir RUNDIR","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  112","line":"RMFILES=()"},
{"lineNum":"  113","line":""},
{"lineNum":"  114","line":"finish(){"},
{"lineNum":"  115","line":"    rm -f \"${RMFILES[@]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  116","line":"    [[ -s $ERRFILE ]] || rm -f \"$ERRFILE\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  117","line":"    for M in ${MOUNTED[@]}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  118","line":"    do"},
{"lineNum":"  119","line":"      umount \"$M\" && rmdir \"$M\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  120","line":"    done"},
{"lineNum":"  121","line":"}"},
{"lineNum":"  122","line":""},
{"lineNum":"  123","line":"atexit finish","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  124","line":""},
{"lineNum":"  125","line":"for ROOT in ${!ROOTS[@]}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  126","line":"do"},
{"lineNum":"  127","line":"    BACKUPDIR=()"},
{"lineNum":"  128","line":"    for DIR in \"${!ROOTOF[@]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  129","line":"    do"},
{"lineNum":"  130","line":"        [[ $ROOT == ${ROOTOF[$DIR]} ]] && BACKUPDIR+=( \"$DIR\" )","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  131","line":"    done"},
{"lineNum":"  132","line":"    [[ ${#BACKUPDIR[@]} -gt 0 ]] || continue","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  133","line":""},
{"lineNum":"  134","line":"\techo","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  135","line":"    [[ $OS == cygwin ]] && (id -G|grep -qE \'\\b544\\b\') && {","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  136","line":"        DRIVE=$(cygpath -w \"$(stat -c%m \"$ROOT\")\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  137","line":"\t\tDRIVE2=\"${DRIVE%\\\\}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  138","line":""},
{"lineNum":"  139","line":"\t\tDOSBASH=$(cygpath -w \"$BASH\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  140","line":""},
{"lineNum":"  141","line":"        NTFS=$(FSUTIL FSINFO VOLUMEINFO $DRIVE2 | fgrep -i \"File System Name\" | fgrep -oi \"NTFS\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  142","line":"        FIXED=$(FSUTIL FSINFO DRIVETYPE $DRIVE2 | fgrep -oi \"Fixed Drive\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  143","line":"        CDRIVES=$(FSUTIL FSINFO DRIVES|sed \'N;s/\\n//g;/^$/d\'|tr \'\\0\' \' \'|grep -Poi \'(?<=Drives:\\s).*\'|tr \'[:lower:]\' \'[:upper:]\')","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  144","line":""},
{"lineNum":"  145","line":"        for LETTER in {I..Z} B {D..H} A","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  146","line":"        do"},
{"lineNum":"  147","line":"        \t[[ $CDRIVES =~ $LETTER ]] || {","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  148","line":"        \t\tMAPLETTER=\"${LETTER}:\" && break","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  149","line":"        \t}"},
{"lineNum":"  150","line":"        done"},
{"lineNum":"  151","line":""},
{"lineNum":"  152","line":"        if [[ -n $MAPLETTER && -n $FIXED && -n $NTFS ]]","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  153","line":"        then"},
{"lineNum":"  154","line":"            echo ntfssnap $DRIVE $MAPLETTER \"${BACKUPDIR[@]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  155","line":"            ntfssnap $DRIVE $MAPLETTER \"${BACKUPDIR[@]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  156","line":"        else"},
{"lineNum":"  157","line":"            backup \"${BACKUPDIR[@]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  158","line":"        fi"},
{"lineNum":"  159","line":"    } || {","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  160","line":"        backup \"${BACKUPDIR[@]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  161","line":"    }"},
{"lineNum":"  162","line":"done"},
]};
var percent_low = 25;var percent_high = 75;
var header = { "command" : "shellspec spec", "date" : "2020-07-07 12:21:07", "instrumented" : 83, "covered" : 0,};
var merged_data = [];
