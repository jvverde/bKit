var data = {lines:[
{"lineNum":"    1","line":"#!/usr/bin/env bash"},
{"lineNum":"    2","line":"SDIR=\"$(dirname -- \"$(readlink -ne -- \"$0\")\")\"\t\t\t\t#Full DIR","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"    3","line":""},
{"lineNum":"    4","line":"set -uE","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"    5","line":""},
{"lineNum":"    6","line":"source \"$SDIR/lib/functions/all.sh\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"    7","line":""},
{"lineNum":"    8","line":"SNAP=\'@snap\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"    9","line":""},
{"lineNum":"   10","line":"set_server () {"},
{"lineNum":"   11","line":"  source \"$SDIR\"/server.sh \"$1\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   12","line":"}"},
{"lineNum":"   13","line":""},
{"lineNum":"   14","line":"declare -a options=()","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   15","line":"while [[ ${1:+$1} =~ ^- ]]","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   16","line":"do"},
{"lineNum":"   17","line":"\tKEY=\"$1\" && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   18","line":"\tcase \"$KEY\" in","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   19","line":"\t\t-l|-log|--log)"},
{"lineNum":"   20","line":"\t\t\texec 1>\"$1\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   21","line":"\t\t\tshift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   22","line":"\t\t;;"},
{"lineNum":"   23","line":"\t\t-l=*|-log=*|--log=*)"},
{"lineNum":"   24","line":"\t\t\texec 1>\"${KEY#*=}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   25","line":"\t\t;;"},
{"lineNum":"   26","line":"\t\t--logdir)"},
{"lineNum":"   27","line":"\t\t\tredirectlogs $1 backup && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   28","line":"\t\t;;"},
{"lineNum":"   29","line":"\t\t--logdir=*)"},
{"lineNum":"   30","line":"\t\t\tredirectlogs \"${KEY#*=}\" backup","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   31","line":"\t\t;;"},
{"lineNum":"   32","line":"\t\t-f|--force)"},
{"lineNum":"   33","line":"\t\t\tFSW=\'-f\' #check if we need it","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   34","line":"\t\t;;"},
{"lineNum":"   35","line":"\t\t-m|--map)"},
{"lineNum":"   36","line":"\t\t\tMOUNTPOINT=\"$1\" && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   37","line":"\t\t\texists cygpath && MOUNTPOINT=$(cygpath \"$MOUNTPOINT\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   38","line":"\t\t;;"},
{"lineNum":"   39","line":"\t\t--snap)"},
{"lineNum":"   40","line":"\t\t\tSNAP=\"@snap/$1\" && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   41","line":"\t\t;;"},
{"lineNum":"   42","line":"\t\t--snap=*)"},
{"lineNum":"   43","line":"\t\t\tSNAP=\"@snap/${KEY#*=}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   44","line":"\t\t;;"},
{"lineNum":"   45","line":"\t\t--burn)"},
{"lineNum":"   46","line":"\t\t\tSNAP=\"@burn\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   47","line":"\t\t;;"},
{"lineNum":"   48","line":"\t\t--backupurl)"},
{"lineNum":"   49","line":"\t\t\tBACKUPURL=\"$1\" && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   50","line":"\t\t;;"},
{"lineNum":"   51","line":"\t\t--backupurl=*)"},
{"lineNum":"   52","line":"\t\t\tBACKUPURL=\"${KEY#*=}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   53","line":"\t\t;;"},
{"lineNum":"   54","line":"\t\t--rvid)"},
{"lineNum":"   55","line":"\t\t\texport BKIT_RVID=\"$1\" && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   56","line":"\t\t;;"},
{"lineNum":"   57","line":"\t\t--rvid=*)"},
{"lineNum":"   58","line":"\t\t\tBKIT_RVID=\"${KEY#*=}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   59","line":"\t\t;;"},
{"lineNum":"   60","line":"\t\t--config)"},
{"lineNum":"   61","line":"\t\t\tCONFIG=\"$1\" && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   62","line":"\t\t;;"},
{"lineNum":"   63","line":"\t\t--config=*)"},
{"lineNum":"   64","line":"\t\t\tCONFIG=\"${KEY#*=}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   65","line":"\t\t;;"},
{"lineNum":"   66","line":"    -s|--server)"},
{"lineNum":"   67","line":"      set_server \"$1\" && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   68","line":"    ;;"},
{"lineNum":"   69","line":"    -s=*|--server=*)"},
{"lineNum":"   70","line":"      set_server \"${KEY#*=}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   71","line":"    ;;"},
{"lineNum":"   72","line":"\t\t--stats)"},
{"lineNum":"   73","line":"\t\t\tstats=1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   74","line":"\t\t;;"},
{"lineNum":"   75","line":"\t\t--sendlogs)"},
{"lineNum":"   76","line":"\t\t\tFULLREPORT=1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   77","line":"\t\t\tNOTIFY=1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   78","line":"\t\t\tstats=1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   79","line":"\t\t;;"},
{"lineNum":"   80","line":"\t\t--no-ssh)"},
{"lineNum":"   81","line":"\t\t\texport NOSSH=1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   82","line":"\t\t;;"},
{"lineNum":"   83","line":"\t\t--notify)"},
{"lineNum":"   84","line":"\t\t\tNOTIFY=1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   85","line":"\t\t\tstats=1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   86","line":"\t\t;;"},
{"lineNum":"   87","line":"\t\t--email=*)"},
{"lineNum":"   88","line":"\t\t\tEMAIL=\"${KEY#*=}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   89","line":"\t\t\tNOTIFY=1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   90","line":"\t\t\tstats=1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   91","line":"\t\t;;"},
{"lineNum":"   92","line":"    --dry-run)"},
{"lineNum":"   93","line":"      declare dryrun=\"dryrun\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   94","line":"      options+=(\"--dry-run\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   95","line":"    ;;"},
{"lineNum":"   96","line":"\t\t-- )"},
{"lineNum":"   97","line":"\t\t\twhile [[ $1 =~ ^- ]]","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   98","line":"\t\t\tdo"},
{"lineNum":"   99","line":"\t\t\t\toptions+=(\"$1\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  100","line":"\t\t\t\tshift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  101","line":"\t\t\tdone"},
{"lineNum":"  102","line":"\t\t;;"},
{"lineNum":"  103","line":"\t\t*)"},
{"lineNum":"  104","line":"\t\t\tdie Unknown\toption $KEY","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  105","line":"\t\t;;"},
{"lineNum":"  106","line":"\tesac"},
{"lineNum":"  107","line":"done"},
{"lineNum":"  108","line":""},
{"lineNum":"  109","line":"source \"$SDIR/ccrsync.sh\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  110","line":""},
{"lineNum":"  111","line":"declare -a ORIGINALDIR=( \"${@:-.}\" ) #dir names as seen by the user (linux vs windows path)","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  112","line":"declare -a ARGS=(\"${@:-.}\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  113","line":""},
{"lineNum":"  114","line":"exists cygpath && {","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  115","line":"  ARGS=()"},
{"lineNum":"  116","line":"  ORIGINALDIR=()"},
{"lineNum":"  117","line":"  for arg in \"${@:-.}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  118","line":"  do"},
{"lineNum":"  119","line":"    ARGS+=( \"$(cygpath -u \"$arg\")\" )","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  120","line":"    ORIGINALDIR+=( \"$(cygpath -w \"$arg\")\" )","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  121","line":"  done"},
{"lineNum":"  122","line":"}"},
{"lineNum":"  123","line":""},
{"lineNum":"  124","line":"declare -a BASEDIR=()","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  125","line":""},
{"lineNum":"  126","line":"for arg in \"${ARGS[@]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  127","line":"do"},
{"lineNum":"  128","line":"  basepath=\"$(readlink -en \"$arg\")\" || {","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  129","line":"    warn \"\'$arg\' doesn\'t seem to exist. It won\'t be selected to backup\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  130","line":"    continue","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  131","line":"  }"},
{"lineNum":"  132","line":"  BASEDIR+=( \"$basepath\" )","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  133","line":"done"},
{"lineNum":"  134","line":""},
{"lineNum":"  135","line":"ROOTS=( $(stat -c%m \"${BASEDIR[@]}\") ) || die \"Error: stat -c%m \'${BASEDIR[@]}\'\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  136","line":""},
{"lineNum":"  137","line":"ROOT=${ROOTS[0]}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  138","line":""},
{"lineNum":"  139","line":"[[ -e \"$ROOT\" ]] || die \"I didn\'t find a disk for directory/file: \'${BASEDIR[0]}\'\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  140","line":""},
{"lineNum":"  141","line":"#[[ -n $MOUNTPOINT ]] || MOUNTPOINT=$ROOT"},
{"lineNum":"  142","line":"true ${MOUNTPOINT:=\"$ROOT\"}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  143","line":""},
{"lineNum":"  144","line":"STARTDIR=()"},
{"lineNum":"  145","line":"BACKUPDIR=()"},
{"lineNum":"  146","line":"for I in ${!ROOTS[@]}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  147","line":"do"},
{"lineNum":"  148","line":"\t[[ \"${ROOTS[$I]}\" == \"$ROOT\" ]] || {","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  149","line":"\t\twarn \"Roots are not in the same logical volume. These will be ignored:\\n\\t${ORIGINALDIR[$I]}\" && continue","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  150","line":"\t}"},
{"lineNum":"  151","line":"\tDIR=${BASEDIR[$I]#$ROOT}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  152","line":"\tDIR=${DIR#/}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  153","line":"\tSTARTDIR+=( \"$DIR\" )","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  154","line":"\tBACKUPDIR+=( \"$MOUNTPOINT/$DIR\" )","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  155","line":"done"},
{"lineNum":"  156","line":""},
{"lineNum":"  157","line":"#We need ROOT, BACKUPDIR and STARTDIR"},
{"lineNum":"  158","line":"#[[ ${BKIT_RVID:-} =~ .+\\..+\\..+\\..+\\..+ ]] || source \"$SDIR/lib/rvid.sh\" || die \"Can\'t source rvid\""},
{"lineNum":"  159","line":""},
{"lineNum":"  160","line":"[[ ${BKIT_RVID+isset} == isset ]] || source \"$SDIR/lib/rvid.sh\" \"$ROOT\" || die \"Can\'t source rvid\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  161","line":""},
{"lineNum":"  162","line":""},
{"lineNum":"  163","line":"exists rsync || die Cannot find rsync","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  164","line":""},
{"lineNum":"  165","line":"trap \'\' SIGPIPE","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  166","line":""},
{"lineNum":"  167","line":"dorsync2(){"},
{"lineNum":"  168","line":"\tlocal RETRIES=300","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  169","line":"\twhile true","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  170","line":"\tdo"},
{"lineNum":"  171","line":"    rsync ${RSYNCOPTIONS+\"${RSYNCOPTIONS[@]}\"} ${options+\"${options[@]}\"} --one-file-system --compress \"$@\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  172","line":"\t\tlocal ret=$?","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  173","line":"\t\tcase $ret in","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  174","line":"\t\t\t0) break \t\t\t\t\t\t\t\t\t#this is a success","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  175","line":"\t\t\t;;"},
{"lineNum":"  176","line":"\t\t\t5|10|12|30|35)"},
{"lineNum":"  177","line":"\t\t\t\tDELAY=$((1 + RANDOM % 60))","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  178","line":"\t\t\t\twarn \"Received error $ret. Try again in $DELAY seconds\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  179","line":"\t\t\t\tsleep $DELAY","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  180","line":"\t\t\t\twarn \"Try again now\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  181","line":"\t\t\t;;"},
{"lineNum":"  182","line":"\t\t\t*)"},
{"lineNum":"  183","line":"\t\t\t\twarn \"Fail to backup. Exit value of rsync is non null: $ret\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  184","line":"\t\t\t\tbreak","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  185","line":"\t\t\t;;"},
{"lineNum":"  186","line":"\t\tesac"},
{"lineNum":"  187","line":"\t\t(( --RETRIES < 0 )) && warn \"I\'m tired of trying\" && break","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  188","line":"\tdone"},
{"lineNum":"  189","line":"}"},
{"lineNum":"  190","line":""},
{"lineNum":"  191","line":"dorsync(){"},
{"lineNum":"  192","line":"\tdorsync2 \"$@\" | grep -v \'unpack_smb_acl\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  193","line":"}"},
{"lineNum":"  194","line":""},
{"lineNum":"  195","line":"mktempdir RUNDIR || die \"Can\'t create a temporary working directory\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  196","line":""},
{"lineNum":"  197","line":"FLIST=\"$RUNDIR/file-list.$$\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  198","line":"HLIST=\"$RUNDIR/hl-list.$$\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  199","line":"DLIST=\"$RUNDIR/dir-list.$$\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  200","line":"NOW=\"$(date +\"%Y-%m-%dT%Hh%Mm%S(%:::z).%a.%W\")\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  201","line":"logfile=\"$VARDIR/log/backup/$NOW.log\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  202","line":"errfile=\"$VARDIR/log/backup/$NOW.err\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  203","line":"statsfile=\"$VARDIR/log/backup/$NOW.stat\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  204","line":""},
{"lineNum":"  205","line":"mkdir -pv \"${logfile%/*}\" \"${errfile%/*}\" \"${statsfile%/*}\" #Just ensure that the log directory exists","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  206","line":""},
{"lineNum":"  207","line":"exec {ERR}>&2","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  208","line":"exec 2> >(tee \"$errfile\" >&$ERR)","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  209","line":"exec {OUT}>&1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  210","line":"exec 1> >(tee \"$logfile\" >&$OUT)","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  211","line":""},
{"lineNum":"  212","line":"set_postpone_files(){"},
{"lineNum":"  213","line":"\texec {FDA}>\"$HLIST\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  214","line":"\texec {FDB}>\"$DLIST\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  215","line":"\texec {FDC}>\"$FLIST\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  216","line":"}"},
{"lineNum":"  217","line":"remove_postpone_files(){"},
{"lineNum":"  218","line":"\trm -f \"$HLIST\" \"$DLIST\" \"$FLIST\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  219","line":"}"},
{"lineNum":"  220","line":"postpone_file(){"},
{"lineNum":"  221","line":"\t#(IFS=$\'\\n\' && echo \"$*\" ) >&97"},
{"lineNum":"  222","line":"\t(IFS=$\'\\n\' && echo \"$*\" ) >&$FDC","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  223","line":"}"},
{"lineNum":"  224","line":"postpone_hl(){"},
{"lineNum":"  225","line":"\t#(IFS=$\'\\n\' && echo \"$*\" ) >&99"},
{"lineNum":"  226","line":"\t(IFS=$\'\\n\' && echo \"$*\" ) >&$FDA","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  227","line":"}"},
{"lineNum":"  228","line":"postpone_update(){"},
{"lineNum":"  229","line":"\t#(IFS=$\'\\n\' && echo \"$*\" ) >&98"},
{"lineNum":"  230","line":"\t(IFS=$\'\\n\' && echo \"$*\" ) >&$FDB","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  231","line":"}"},
{"lineNum":"  232","line":""},
{"lineNum":"  233","line":"FMT=\'--out-format=\"%o|%i|%f|%c|%b|%l|%t\"\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  234","line":"PERM=(--perms --acls --owner --group --super --numeric-ids --devices --specials)","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  235","line":"exists cygpath || PERM+=(-XX)","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  236","line":"CLEAN=(--delete-delay --force --delete-excluded --ignore-non-existing --ignore-existing)","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  237","line":""},
{"lineNum":"  238","line":"update_hardlinks(){"},
{"lineNum":"  239","line":"\tFILE=\"${HLIST}.sort\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  240","line":"\tLC_ALL=C sort -o \"$FILE\" \"$HLIST\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  241","line":"\tdorsync --delete --archive --hard-links --relative --files-from=\"$FILE\" --recursive --itemize-changes \"${PERM[@]}\" $FMT \"$@\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  242","line":"\trm -f \"$FILE\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  243","line":"}"},
{"lineNum":"  244","line":"update_dirs(){"},
{"lineNum":"  245","line":"\tFILE=\"${DLIST}.sort\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  246","line":"\tLC_ALL=C sort -o \"$FILE\" \"$DLIST\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  247","line":"\tdorsync --delete --archive --relative --files-from=\"$FILE\" --itemize-changes \"${PERM[@]}\" $FMT \"$@\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  248","line":"\trm -f \"$FILE\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  249","line":"}"},
{"lineNum":"  250","line":"update_file(){"},
{"lineNum":"  251","line":"\tdorsync -tiz --inplace \"${PERM[@]}\" $FMT \"$@\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  252","line":"}"},
{"lineNum":"  253","line":"update_files(){"},
{"lineNum":"  254","line":"\tSRC=$1 && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  255","line":"\tFILE=\"${SRC}.sort\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  256","line":"\tLC_ALL=C sort -o \"$FILE\" \"$SRC\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  257","line":"\tdorsync --delete --archive --inplace --hard-links --relative --files-from=\"$FILE\" --itemize-changes \"${PERM[@]}\" $FMT \"$@\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  258","line":"\t#echo dorsync --delete --archive --inplace --hard-links --relative --files-from=\"$FILE\" --itemize-changes \"${PERM[@]}\" $FMT \"$@\""},
{"lineNum":"  259","line":"\t#cat \"$FILE\""},
{"lineNum":"  260","line":"\trm -f \"$FILE\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  261","line":"}"},
{"lineNum":"  262","line":""},
{"lineNum":"  263","line":"clean(){"},
{"lineNum":"  264","line":"\tlocal BASE=$1 && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  265","line":"\t#local SRC=\"$1/./$2\""},
{"lineNum":"  266","line":"\tlocal SRCS=()","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  267","line":"\tfor DIR in \"${@:1:$#-1}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  268","line":"\tdo"},
{"lineNum":"  269","line":"\t\tSRCS+=( \"$BASE/./$DIR\" )","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  270","line":"\tdone"},
{"lineNum":"  271","line":"\tlocal DST=\"${@: -1}\" #last argument","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  272","line":""},
{"lineNum":"  273","line":"\tdorsync -riHDR \"${CLEAN[@]}\" \"${PERM[@]}\" $FMT \"${SRCS[@]}\" \"$DST\" #clean deleted files","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  274","line":"}"},
{"lineNum":"  275","line":""},
{"lineNum":"  276","line":"snapshot(){"},
{"lineNum":"  277","line":"\tdorsync --dry-run --ignore-non-existing --ignore-existing \"$MOUNTPOINT/./\" \"$BACKUPURL/$BKIT_RVID/$SNAP\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  278","line":"}"},
{"lineNum":"  279","line":"prepare(){"},
{"lineNum":"  280","line":"\tdorsync --dry-run --ignore-non-existing --ignore-existing \"$MOUNTPOINT/./\" \"$BACKUPURL/$BKIT_RVID/@current/data\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  281","line":"}"},
{"lineNum":"  282","line":""},
{"lineNum":"  283","line":"exec {UPLOAD}>&1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  284","line":""},
{"lineNum":"  285","line":"upload_manifest(){"},
{"lineNum":"  286","line":"  exec 1>&$UPLOAD","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  287","line":"  local BASE=\"$1\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  288","line":"  local PREFIX=\"$2\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  289","line":""},
{"lineNum":"  290","line":"  #echo upload manifest for $*"},
{"lineNum":"  291","line":"  declare manifest=\"$RUNDIR/manifest.$$\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  292","line":"  declare files=\"$RUNDIR/files.$$\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  293","line":"  :> \"$manifest\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  294","line":"  :> \"$files\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  295","line":"  send_manifest(){"},
{"lineNum":"  296","line":"      update_file \"$manifest\" \"$BACKUPURL/$BKIT_RVID/@manifest/$PREFIX/manifest.lst\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  297","line":"      update_file \"$manifest\" \"$BACKUPURL/$BKIT_RVID/@apply-manifest/$PREFIX/manifest.lst\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  298","line":"      cut -d\'|\' -f4- \"$manifest\" > \"$files\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  299","line":"      update_files \"$files\" \"$BASE\" \"$BACKUPURL/$BKIT_RVID/@seed/$PREFIX\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  300","line":"      update_file \"$manifest\" \"$BACKUPURL/$BKIT_RVID/@apply-seed/$PREFIX/manifest.lst\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  301","line":"      :> \"$manifest\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  302","line":"  }"},
{"lineNum":"  303","line":""},
{"lineNum":"  304","line":"  declare -i cnt=0","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  305","line":""},
{"lineNum":"  306","line":"  while IFS= read -r line","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  307","line":"  do"},
{"lineNum":"  308","line":"    echo \"$line\" >> \"$manifest\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  309","line":"    (( ++cnt > 50 )) && {","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  310","line":"      send_manifest","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  311","line":"      (( cnt = 0 ))"},
{"lineNum":"  312","line":"    }"},
{"lineNum":"  313","line":"  done"},
{"lineNum":"  314","line":"  [[ -s $manifest ]] && send_manifest","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  315","line":"}"},
{"lineNum":"  316","line":""},
{"lineNum":"  317","line":"backupACLS(){"},
{"lineNum":"  318","line":"  local FMT=\'--out-format=ACL:\"%o|%i|%f|%c|%b|%l|%t\"\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  319","line":"  local FMT_QUERY=\'--out-format=%i|/%f\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  320","line":"  local ACLFILE=\'.bkit-dir-acl\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  321","line":"  local BASE=$1 && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  322","line":"  declare -a SRCS=()","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  323","line":"  declare -a MDIRS=()","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  324","line":""},
{"lineNum":"  325","line":"  declare -r metadatadir=\"${VARDIR:-$SDIR}/cache-bkit/metadata/by-volume/${BKIT_VOLUMESERIALNUMBER:-_}/\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  326","line":""},
{"lineNum":"  327","line":"  [[ -d $metadatadir ]] || mkdir -pv \"$metadatadir\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  328","line":""},
{"lineNum":"  329","line":"  for DIR in \"$@\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  330","line":"  do"},
{"lineNum":"  331","line":"    SRCS+=( \"$BASE/./$DIR\" )","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  332","line":"    [[ -d \"${metadatadir}${DIR}\" ]] || mkdir -pv \"${metadatadir}${DIR}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  333","line":"    MDIRS+=( \"${metadatadir}${DIR}\" )","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  334","line":"  done"},
{"lineNum":"  335","line":""},
{"lineNum":"  336","line":"  local Loptions=(","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  337","line":"    --no-verbose","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  338","line":"    --recursive","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  339","line":"    --relative","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  340","line":"    --super","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  341","line":"    --times","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  342","line":"    --itemize-changes","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  343","line":"    --exclude=\"$ACLFILE\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  344","line":"    --exclude=\".rsync-filter\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  345","line":"    $FMT_QUERY","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  346","line":"  )"},
{"lineNum":"  347","line":""},
{"lineNum":"  348","line":"  local ACLSoptions=(","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  349","line":"    --acls","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  350","line":"    --owner","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  351","line":"    --group","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  352","line":"    --perms","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  353","line":"  )"},
{"lineNum":"  354","line":""},
{"lineNum":"  355","line":"  echo \"a) Generate missing metafiles in local cache\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  356","line":"  {"},
{"lineNum":"  357","line":""},
{"lineNum":"  358","line":"    exec 11>&1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  359","line":"    while IFS=\'|\' read -r I FILE","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  360","line":"    do"},
{"lineNum":"  361","line":"      [[ $I =~ skipping ]] && continue","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  362","line":"      #J=${I#?????}           #remove first 5 characteres ex: >f.st"},
{"lineNum":"  363","line":"      J=${I#????}             #remove first 4 characteres ex: >f.s #That means don\'t consider size (of course) only time, permisions, owners are important","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  364","line":"      [[ $J =~ [^.] ]] && {","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  365","line":"        echo \"ACL miss:$I|$FILE\" >&11","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  366","line":"        echo \"$FILE\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  367","line":"      }"},
{"lineNum":"  368","line":"    done < <(dorsync --dry-run \"${Loptions[@]}\" \"${ACLSoptions[@]}\" \"${SRCS[@]}\" \"$metadatadir\") |","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  369","line":"      bash \"$SDIR/storeACLs.sh\" --diracl=\"$ACLFILE\" \"$metadatadir\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  370","line":"  } | sed -e \'s/^/\\t/\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  371","line":""},
{"lineNum":"  372","line":"  echo \"b) Update attributes and Clean metafiles on local cache\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  373","line":"  {"},
{"lineNum":"  374","line":"    dorsync --ignore-non-existing --ignore-existing --delete --delete-excluded --force \"${Loptions[@]}\" \"${SRCS[@]}\" \"$metadatadir\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  375","line":"  } | sed -e \'s/^/\\t/\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  376","line":""},
{"lineNum":"  377","line":"  echo \"c) Backup metafiles from local cache to backup server\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  378","line":"  {"},
{"lineNum":"  379","line":"    coproc upload_manifest \"$metadatadir\" \'metadata\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  380","line":"    {"},
{"lineNum":"  381","line":"      export BKIT_TARGET=\'metadata\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  382","line":"      export BKIT_MNTPOINT=\"$metadatadir\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  383","line":"      bash \"$SDIR/hashit.sh\"  ${options+\"${options[@]}\"} \"${MDIRS[@]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  384","line":"    } >&\"${COPROC[1]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  385","line":"    exec {COPROC[1]}>&-","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  386","line":"    wait $COPROC_PID","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  387","line":"  } | sed -e \'s/^/\\t/\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  388","line":""},
{"lineNum":"  389","line":"  echo \"d) Update metafiles attributes\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  390","line":"  {"},
{"lineNum":"  391","line":"    update \"$metadatadir\" \"$@\" \"$BACKUPURL/$BKIT_RVID/@current/metadata\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  392","line":"  } | sed -e \'s/^/\\t/\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  393","line":""},
{"lineNum":"  394","line":"  echo \"e) Clean metafiles on server\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  395","line":"  {"},
{"lineNum":"  396","line":"    clean \"$metadatadir\" \"$@\" \"$BACKUPURL/$BKIT_RVID/@current/metadata\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  397","line":"  } | sed -e \'s/^/\\t/\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  398","line":"}"},
{"lineNum":"  399","line":""},
{"lineNum":"  400","line":""},
{"lineNum":"  401","line":"update(){"},
{"lineNum":"  402","line":"  local FMT_QUERY=\'--out-format=%i|%n|%L|/%f|%l\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  403","line":"  local BASE=$(readlink -e \"$1\") && shift","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  404","line":"  #local SRC=\"$1/./$2\""},
{"lineNum":"  405","line":"  local SRCS=()","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  406","line":"  for DIR in \"${@:1:$#-1}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  407","line":"  do"},
{"lineNum":"  408","line":"    DIR=${DIR#/}    #remove any leading slash if any}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  409","line":"    SRCS+=( \"$BASE/./$DIR\" )","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  410","line":"  done"},
{"lineNum":"  411","line":"  local DST=\"${@: -1}\" #last argument","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  412","line":"  unset hlinks","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  413","line":"  set_postpone_files","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  414","line":""},
{"lineNum":"  415","line":"  coproc upload_manifest \"$BASE\" \'data\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  416","line":""},
{"lineNum":"  417","line":"  while IFS=\'|\' read -r I FILE LINK FULLPATH LEN","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  418","line":"  do"},
{"lineNum":"  419","line":"    #echo miss \"$I|$FILE|$LINK|$LEN\""},
{"lineNum":"  420","line":""},
{"lineNum":"  421","line":"    FILE=${FILE%/}  #remove trailing backslash in order to avoid sync files in a directory directly","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  422","line":""},
{"lineNum":"  423","line":"    #if it is a directory, symlink, device or special"},
{"lineNum":"  424","line":"    #[[ $I =~ ^[c.][dLDS] && \"$FILE\" != \'.\' ]] && postpone_update \"$FILE\" && continue"},
{"lineNum":"  425","line":"    [[ $I =~ ^[c.][dLDS] ]] && postpone_update \"$FILE\" && continue","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  426","line":""},
{"lineNum":"  427","line":"    #this is the main (and most costly) case. A file, or part of it, need to be transfer"},
{"lineNum":"  428","line":"    [[ $I =~ ^[.\\<]f ]] && {","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  429","line":"      HASH=$(sha256sum -b \"$FULLPATH\" | cut -d\' \' -f1)","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  430","line":"      PREFIX=$(echo $HASH|sed -E \'s#^(.)(.)(.)(.)(.)(.)#\\1/\\2/\\3/\\4/\\5/\\6/#\')","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  431","line":"      [[ $PREFIX =~ ././././././ ]] &&","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  432","line":"        echo \"$PREFIX|$(stat -c \'%s|%Y\' \"$FULLPATH\")|$FILE\" >&\"${COPROC[1]}\" ||","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  433","line":"          echo \"Prefix \'$PREFIX\' !~ ././././././\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  434","line":"    } && continue","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  435","line":""},
{"lineNum":"  436","line":"    #if it is a hard link (to file or to symlink)"},
{"lineNum":"  437","line":"    [[ $I =~ ^h[fL] && $LINK =~ =\\> ]] && LINK=\"$(echo $LINK|sed -E \'s/\\s*=>\\s*//\')\" &&  postpone_hl \"$LINK\" \"$FILE\" && continue","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  438","line":""},
{"lineNum":"  439","line":"    #(if) There are situations where the rsync don\'t know yet the target of a hardlink, so we need to flag this situation and later we take care of it"},
{"lineNum":"  440","line":"    [[ $I =~ ^h[fL] && ! $LINK =~ =\\> ]] && hlinks=missing && continue","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  441","line":""},
{"lineNum":"  442","line":"    [[ $I =~ ^\\*deleting ]] && continue","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  443","line":""},
{"lineNum":"  444","line":"    echo \"Hum.. Is something else:$I|$FILE|$LINK|$LEN\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  445","line":""},
{"lineNum":"  446","line":"  done < <(dorsync --dry-run --no-verbose --archive --hard-links --relative --itemize-changes \"${PERM[@]}\" $FMT_QUERY \"${SRCS[@]}\" \"$DST\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  447","line":""},
{"lineNum":"  448","line":"  exec {COPROC[1]}>&-","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  449","line":"  wait $COPROC_PID","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  450","line":""},
{"lineNum":"  451","line":"  update_dirs \"$BASE\" \"$DST\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  452","line":"  update_hardlinks \"$BASE\" \"$DST\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  453","line":"  remove_postpone_files","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  454","line":"}"},
{"lineNum":"  455","line":""},
{"lineNum":"  456","line":"backup(){"},
{"lineNum":"  457","line":"  coproc upload_manifest \"$MOUNTPOINT\" \'data\'","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  458","line":"  bash \"$SDIR/hashit.sh\" ${options+\"${options[@]}\"}  \"${BACKUPDIR[@]}\" >&\"${COPROC[1]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  459","line":"  exec {COPROC[1]}>&-","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  460","line":"  wait $COPROC_PID","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  461","line":"}"},
{"lineNum":"  462","line":"######################### Start Backup Algorithm #########################"},
{"lineNum":"  463","line":""},
{"lineNum":"  464","line":"declare -i cnt=0","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  465","line":"ITIME=$(date -R)","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  466","line":""},
{"lineNum":"  467","line":"{"},
{"lineNum":"  468","line":"  echo \"Backup to $BACKUPURL\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  469","line":"  prepare","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  470","line":""},
{"lineNum":"  471","line":"  echo \"Start to backup directories/files on \'${ORIGINALDIR[@]}\' on $ITIME\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  472","line":"  echo -e \"\\nPhase $((++cnt)) - Backup new/modified files\\n\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  473","line":""},
{"lineNum":"  474","line":"  backup","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  475","line":""},
{"lineNum":"  476","line":"  echo -e \"\\nPhase $((++cnt)) - Update Symbolic links, Hard links, Directories, File attributes and... meanwhile changed files\\n\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  477","line":""},
{"lineNum":"  478","line":"  update \"$MOUNTPOINT\" \"${STARTDIR[@]}\" \"$BACKUPURL/$BKIT_RVID/@current/data\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  479","line":""},
{"lineNum":"  480","line":"  [[ ${hlinks+isset} == isset ]] && {","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  481","line":"    echo -e \"\\n\\tPhase ${cnt}.1 update delayed hardlinks\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  482","line":"    update \"$MOUNTPOINT\" \"${STARTDIR[@]}\" \"$BACKUPURL/$BKIT_RVID/@current/data\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  483","line":"  }"},
{"lineNum":"  484","line":""},
{"lineNum":"  485","line":"  echo -e \"\\nPhase $((++cnt)) - Clean deleted files from backup\\n\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  486","line":""},
{"lineNum":"  487","line":"  clean \"$MOUNTPOINT\" \"${STARTDIR[@]}\" \"$BACKUPURL/$BKIT_RVID/@current/data\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  488","line":""},
{"lineNum":"  489","line":"  [[ $OS == \'cygwin\' && $BKIT_FILESYSTEM == \'NTFS\' ]] && (id -G|grep -qE \'\\b544\\b\') && (","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  490","line":"    echo -e \"\\nPhase $((++cnt)) - Backup ACLS\\n\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  491","line":"\t#Need a better revision"},
{"lineNum":"  492","line":"    #backupACLS \"$MOUNTPOINT\" \"${STARTDIR[@]}\" |sed -e \'s/^/\\t/\'"},
{"lineNum":"  493","line":"  )"},
{"lineNum":"  494","line":""},
{"lineNum":"  495","line":"  [[ ${dryrun+isset} == isset ]] || {","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  496","line":"    echo -e \"\\nPhase $((++cnt)) - Create a readonly snapshot on server\\n\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  497","line":""},
{"lineNum":"  498","line":"    snapshot","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  499","line":"  }"},
{"lineNum":"  500","line":""},
{"lineNum":"  501","line":"  echo \"Backup done on $(date -R) for:\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  502","line":"  for I in ${!ORIGINALDIR[@]}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  503","line":"  do"},
{"lineNum":"  504","line":"    echo \"Files/directories \'${ORIGINALDIR[$I]}\' backed up on:\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  505","line":"    echo -e \"\\t$BACKUPURL/$BKIT_RVID/@current/data/${STARTDIR[$I]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  506","line":"  done"},
{"lineNum":"  507","line":"}"},
{"lineNum":"  508","line":""},
{"lineNum":"  509","line":""},
{"lineNum":"  510","line":"######################### Now some stats if requested #########################"},
{"lineNum":"  511","line":""},
{"lineNum":"  512","line":"[[ ${stats+isset} == isset && -e $logfile && -e \"$SDIR/lib/tools/stats/send-stats.pl\" ]] && exists perl && {","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  513","line":"  echo \"------------Stats------------\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  514","line":"  deltatime \"$(date -R)\" \"$ITIME\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  515","line":"  echo \"Total time spent: $DELTATIME\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  516","line":"  exists cygpath && ROOT=$(cygpath -w \"$ROOT\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  517","line":"  cat -v \"$logfile\" | grep -Pio \'^\".+\"$\' | awk -vA=\"$ROOT\" \'BEGIN {FS = OFS = \"|\"} {print $1,$2,A $3,$4,$5,$6,$7}\' | perl \"$SDIR/lib/tools/stats/send-stats.pl\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  518","line":"  echo \"------------End of Stats------------\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  519","line":"} | tee \"$statsfile\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  520","line":""},
{"lineNum":"  521","line":"######################### Sent email if required #########################"},
{"lineNum":"  522","line":"[[ ${NOTIFY+isset} == isset && -s $statsfile ]] && (","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  523","line":"  ME=$(uname -n)","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  524","line":"  FULLDIRS=( $(readlink -e \"${ORIGINALDIR[@]}\") )     #get full paths","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  525","line":"  exists cygpath &&  FULLDIRS=( $(cygpath -w \"${FULLDIRS[@]}\") )","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  526","line":"  printf -v DIRS \"%s, \" \"${FULLDIRS[@]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  527","line":"  DIRS=${DIRS%, } #rm last comma","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  528","line":"  WHAT=$DIRS","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  529","line":"  let NUMBEROFDIRS=${#FULLDIRS[@]}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  530","line":"  let LIMIT=3","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  531","line":"  let EXTRADIRS=NUMBEROFDIRS-LIMIT","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  532","line":"  ((NUMBEROFDIRS > LIMIT)) && WHAT=\"${FULLDIRS[0]} and $EXTRADIRS more directories/files\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  533","line":""},
{"lineNum":"  534","line":"  [[ -s $errfile ]] \\","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  535","line":"    && SUBJECT=\"Some errors occurred while backing up $WHAT on $ME at $(date +%Hh%Mm)\" \\"},
{"lineNum":"  536","line":"    || SUBJECT=\"Backup of $WHAT on $ME successfully finished at $(date +%Hh%Mm)\""},
{"lineNum":"  537","line":"  {"},
{"lineNum":"  538","line":"    echo \"Backup of $DIRS\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  539","line":"    cat \"$statsfile\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  540","line":""},
{"lineNum":"  541","line":"    [[ -s $errfile ]] && {","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  542","line":"      echo -e \"\\n------------Errors found------------\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  543","line":"      cat \"$errfile\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  544","line":"      echo \"------------End of Errors------------\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  545","line":"    }"},
{"lineNum":"  546","line":""},
{"lineNum":"  547","line":"    [[ ${FULLREPORT+isset} == isset ]] && {","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  548","line":"      echo -e \"\\n------------Full Logs------------\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  549","line":"      cat \"$logfile\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  550","line":"      echo \"------------End of Logs------------\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  551","line":"    }"},
{"lineNum":"  552","line":"  } | sendnotify \"$SUBJECT\" \"$ME\" \"${EMAIL:-}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  553","line":")"},
{"lineNum":"  554","line":""},
{"lineNum":"  555","line":"[[ -s $errfile ]] && echo \"Backup done with some errors. Please check \'$errfile\'\" || rm \"$errfile\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  556","line":""},
{"lineNum":"  557","line":"deltatime \"$(date -R)\" \"$ITIME\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  558","line":"echo \"Backup done in $DELTATIME\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  559","line":"exit 0","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  560","line":""},
]};
var percent_low = 25;var percent_high = 75;
var header = { "command" : "shellspec spec", "date" : "2020-07-07 12:21:07", "instrumented" : 299, "covered" : 0,};
var merged_data = [];
